{% extends "mealplanmaker/layout.html" %}

{% block body %}

<br>
<h1 style="color: #00981e; size: 15pt; text-align: center;">TDEE Calculator</h1>
<br>

<div style="max-width: 600px; margin: auto;">
<form id="tdeeform" onsubmit="calculateCalories(); return false;">

    <div class="form-group">
      <label for="weight" style="font-weight: bold;">Weight</label>
      <input type="text" class="form-control" name="weight" id="weight" placeholder="kg" onkeydown="calculateCalories();">
    </div>

    <div class="form-group">
        <label for="height" style="font-weight: bold;">Height</label>
        <input type="text" class="form-control" name="height" id="height" placeholder="cm" onkeydown="calculateCalories();">
    </div>

    <div class="form-group">
        <label for="gender" style="font-weight: bold;">Gender</label>
        <br>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="gender" id="maleradio" value="male" onclick="calculateCalories();">
            <label class="form-check-label" for="maleradio">Male</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="gender" id="femaleradio" value="female" onclick="calculateCalories();">
            <label class="form-check-label" for="femaleradio">Female</label>
        </div>
    </div>

    <div class="form-group">
        <label for="age" style="font-weight: bold;">Age</label>
        <input type="text" class="form-control" name="age" id="age" placeholder="30" onkeydown="calculateCalories();">
    </div>

    <div class="form-group">
      <label for="activitylevel" style="font-weight: bold;">Activity Level</label>
      <select class="form-control" id="activitylevel" onchange="calculateCalories();">
        <option value="1">Sedentary (office job)</option>
        <option value="2">Light (1-3 days/week)</option>
        <option value="3">Moderate (3-5 days/week)</option>
        <option value="4">Heavy (6-7 days/week)</option>
        <option value="5">Athlete (twice a day)</option>
      </select>
    </div>

</form>
</div>

<br>

<h4 style="color: #404040; text-align: center;">Your Recommended Daily Calorie Intake:</h4>
<br>
<h1 style="color: #007EC7; text-align: center;" id="calories_result">{{ calories }}</h1>

<br><br>

<div style="max-width: 600px; margin: auto;">
    <p style="text-align: center; size: 20sp; font-weight: lighter; text-align: justify; color: #000000;"> Fill in the above form to calculate your recommended calorie daily intake </p>
</div>
<br>

<script>
function calculateCalories() {
    // Get form
    var form = document.forms["tdeeform"];

    // Get gender value
    var gender = form.elements["gender"];
    var gender_value = gender[0].checked ? 5 : -161;
    console.log(gender_value);

    // Activity level array
    var activity_multiplier = [0, 1.2, 1.375, 1.55, 1.725, 1.9];

    // Get activity level value
    var activitylevel_value = activity_multiplier[form.elements["activitylevel"].value];
    console.log(activitylevel_value);

    // Get weight, height, and age
    var weight = form.elements["weight"].value;
    var height = form.elements["height"].value;
    var age = form.elements["age"].value;
    console.log(weight, height, age);

    // Calculate calories
    var calories_result = ((weight * 10) + (height * 6.25) - (5 * age) + gender_value) * activitylevel_value;

    // Negative calories error fixing
    if (calories_result < 0) {
        calories_result = 0;
    }

    // Update view
    document.getElementById('calories_result').innerHTML = calories_result.toFixed(0);

    return false; // Prevent form submission
}


</script>



<br>
<h3 style="color: #00981e; size: 15pt; text-align: center;">Select Your Daily Meals</h3>
<br>

<div style="max-width: 600px; margin: auto;">

    {% if not user.is_authenticated %}

    <div class="alert alert-primary" role="alert" style="width: 600px;">
        <p style="font-size: large; text-align: center; margin-top: 15px;">
        Only <a href="{% url 'login' %}" class="alert-link">Logged in</a> users can create a weekly plan.<br><br>
        dont have an account yet?<a href="{% url 'register' %}">Create one here.</a>
        </p>
    </div>

    {% else %}

    {% if not all_meals %}

    <div class="alert alert-primary" role="alert" style="width: 600px;">
        <p style="font-size: large; text-align: center; margin-top: 15px;">
        You do not currently have any meals <br><br>
        <a href="{% url 'mealcreation' %}" class="alert-link">Create meal</a><br><br>
        </p>
    </div>

    {% else %}
   

    <form id="monday" method="post" action="{% url 'weekly' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="monday" style="font-weight: bold;">Monday</label><br>
            <div class="form-inline">
                <select class="form-control" name="meal_select" id="meal_select" style="width: 450px;">
                    {% for meal in all_meals %}
                    <option value="{{meal.id}}">{{meal.name}}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="day" name="day" value="monday">
                <button type="submit" class="btn btn-outline-success" style="margin-left: 50px; width: 100px;">Add</button>
            </div>
        </div>
    </form>

    <form id="tuesday" method="post" action="{% url 'weekly' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="tuesday" style="font-weight: bold;">Tuesday</label><br>
            <div class="form-inline">
                <select class="form-control" name="meal_select" id="meal_select" style="width: 450px;">
                    {% for meal in all_meals %}
                    <option value="{{meal.id}}">{{meal.name}}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="day" name="day" value="tuesday">
                <button type="submit" class="btn btn-outline-success" style="margin-left: 50px; width: 100px;">Add</button>
            </div>
        </div>
    </form>

    <form id="wednesday" method="post" action="{% url 'weekly' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="wednesday" style="font-weight: bold;">Wednesday</label><br>
            <div class="form-inline">
                <select class="form-control" name="meal_select" id="meal_select" style="width: 450px;">
                    {% for meal in all_meals %}
                    <option value="{{meal.id}}">{{meal.name}}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="day" name="day" value="wednesday">
                <button type="submit" class="btn btn-outline-success" style="margin-left: 50px; width: 100px;">Add</button>
            </div>
        </div>
    </form>

    <form id="thursday" method="post" action="{% url 'weekly' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="thursday" style="font-weight: bold;">Thursday</label><br>
            <div class="form-inline">
                <select class="form-control" name="meal_select" id="meal_select" style="width: 450px;">
                    {% for meal in all_meals %}
                    <option value="{{meal.id}}">{{meal.name}}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="day" name="day" value="thursday">
                <button type="submit" class="btn btn-outline-success" style="margin-left: 50px; width: 100px;">Add</button>
            </div>
        </div>
    </form>

    <form id="friday" method="post" action="{% url 'weekly' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="friday" style="font-weight: bold;">Friday</label><br>
            <div class="form-inline">
                <select class="form-control" name="meal_select" id="meal_select" style="width: 450px;">
                    {% for meal in all_meals %}
                    <option value="{{meal.id}}">{{meal.name}}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="day" name="day" value="friday">
                <button type="submit" class="btn btn-outline-success" style="margin-left: 50px; width: 100px;">Add</button>
            </div>
        </div>
    </form>

    <form id="saturday" method="post" action="{% url 'weekly' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="saturday" style="font-weight: bold;">Saturday</label><br>
            <div class="form-inline">
                <select class="form-control" name="meal_select" id="meal_select" style="width: 450px;">
                    {% for meal in all_meals %}
                    <option value="{{meal.id}}">{{meal.name}}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="day" name="day" value="saturday">
                <button type="submit" class="btn btn-outline-success" style="margin-left: 50px; width: 100px;">Add</button>
            </div>
        </div>
    </form>

    <form id="sunday" method="post" action="{% url 'weekly' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="sunday" style="font-weight: bold;">Sunday</label><br>
            <div class="form-inline">
                <select class="form-control" name="meal_select" id="meal_select" style="width: 450px;">
                    {% for meal in all_meals %}
                    <option value="{{meal.id}}">{{meal.name}}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="day" name="day" value="sunday">
                <button type="submit" class="btn btn-outline-success" style="margin-left: 50px; width: 100px;">Add</button>
            </div>
        </div>
    </form>


    {% endif %}

    <br><br>
    <h1 style="color: #00981e; size: 15pt; text-align: center;">Weekly Plan</h1>
    <br>


    <div class="card" style="width: 600px; margin-bottom: 20px; border-radius: 8px; border-color: gainsboro; text-align: center;">
        <div class="card-body" style="width: 600px;">
                <h5 class="card-title">Monday</h5>
            <div style="display: inline;">
                {% for meal in weekly_meals %}
                {% if meal.day == "monday" %}
                <h6 style="color: #00981e; font-weight: bolder; display: inline;">{{meal.meal.name}}</h6>
                    <form method="post" action="{% url 'deletefromplan' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" id="mealtodelete" name="mealtodelete" value="{{meal.meal.id}}">
                    <input type="hidden" id="daydelete" name="daydelete" value="monday">
                    <button type="submit" class="btn-sm btn-outline-danger" style="display: inline; size: 50%; border: 0; margin-bottom: 5px;">Remove</button>
                    </form>
                    <br>
                    
                    
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card" style="width: 600px; margin-bottom: 20px; border-radius: 8px; border-color: gainsboro; text-align: center;">
        <div class="card-body" style="width: 600px;">
                <h5 class="card-title">Tuesday</h5>
            <div style="display: inline;">
                {% for meal in weekly_meals %}
                {% if meal.day == "tuesday" %}
                <h6 style="color: #00981e; font-weight: bolder; display: inline;">{{meal.meal.name}}</h6>
                    <form method="post" action="{% url 'deletefromplan' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" id="mealtodelete" name="mealtodelete" value="{{meal.meal.id}}">
                    <input type="hidden" id="daydelete" name="daydelete" value="tuesday">
                    <button type="submit" class="btn-sm btn-outline-danger" style="display: inline; size: 50%; border: 0; margin-bottom: 5px;">Remove</button>
                    </form>
                    <br>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card" style="width: 600px; margin-bottom: 20px; border-radius: 8px; border-color: gainsboro; text-align: center;">
        <div class="card-body" style="width: 600px;">
                <h5 class="card-title">Wednesday</h5>
            <div style="display: inline;">
                {% for meal in weekly_meals %}
                {% if meal.day == "wednesday" %}
                <h6 style="color: #00981e; font-weight: bolder; display: inline;">{{meal.meal.name}}</h6>
                    <form method="post" action="{% url 'deletefromplan' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" id="mealtodelete" name="mealtodelete" value="{{meal.meal.id}}">
                    <input type="hidden" id="daydelete" name="daydelete" value="wednesday">
                    <button type="submit" class="btn-sm btn-outline-danger" style="display: inline; size: 50%; border: 0; margin-bottom: 5px;">Remove</button>
                    </form>
                    <br>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card" style="width: 600px; margin-bottom: 20px; border-radius: 8px; border-color: gainsboro; text-align: center;">
        <div class="card-body" style="width: 600px;">
                <h5 class="card-title">Thursday</h5>
            <div style="display: inline;">
                {% for meal in weekly_meals %}
                {% if meal.day == "thursday" %}
                <h6 style="color: #00981e; font-weight: bolder; display: inline;">{{meal.meal.name}}</h6>
                    <form method="post" action="{% url 'deletefromplan' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" id="mealtodelete" name="mealtodelete" value="{{meal.meal.id}}">
                    <input type="hidden" id="daydelete" name="daydelete" value="thursday">
                    <button type="submit" class="btn-sm btn-outline-danger" style="display: inline; size: 50%; border: 0; margin-bottom: 5px;">Remove</button>
                    </form>
                    <br>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card" style="width: 600px; margin-bottom: 20px; border-radius: 8px; border-color: gainsboro; text-align: center;">
        <div class="card-body" style="width: 600px;">
                <h5 class="card-title">Friday</h5>
            <div style="display: inline;">
                {% for meal in weekly_meals %}
                {% if meal.day == "friday" %}
                <h6 style="color: #00981e; font-weight: bolder; display: inline;">{{meal.meal.name}}</h6>
                    <form method="post" action="{% url 'deletefromplan' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" id="mealtodelete" name="mealtodelete" value="{{meal.meal.id}}">
                    <input type="hidden" id="daydelete" name="daydelete" value="friday">
                    <button type="submit" class="btn-sm btn-outline-danger" style="display: inline; size: 50%; border: 0; margin-bottom: 5px;">Remove</button>
                    </form>
                    <br>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card" style="width: 600px; margin-bottom: 20px; border-radius: 8px; border-color: gainsboro; text-align: center;">
        <div class="card-body" style="width: 600px;">
                <h5 class="card-title">Saturday</h5>
            <div style="display: inline;">
                {% for meal in weekly_meals %}
                {% if meal.day == "saturday" %}
                <h6 style="color: #00981e; font-weight: bolder; display: inline;">{{meal.meal.name}}</h6>
                    <form method="post" action="{% url 'deletefromplan' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" id="mealtodelete" name="mealtodelete" value="{{meal.meal.id}}">
                    <input type="hidden" id="daydelete" name="daydelete" value="saturday">
                    <button type="submit" class="btn-sm btn-outline-danger" style="display: inline; size: 50%; border: 0; margin-bottom: 5px;">Remove</button>
                    </form>
                    <br>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="card" style="width: 600px; margin-bottom: 20px; border-radius: 8px; border-color: gainsboro; text-align: center;">
        <div class="card-body" style="width: 600px;">
                <h5 class="card-title">Sunday</h5>
            <div style="display: inline;">
                {% for meal in weekly_meals %}
                {% if meal.day == "sunday" %}
                <h6 style="color: #00981e; font-weight: bolder; display: inline;">{{meal.meal.name}}</h6>
                    <form method="post" action="{% url 'deletefromplan' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" id="mealtodelete" name="mealtodelete" value="{{meal.meal.id}}">
                    <input type="hidden" id="daydelete" name="daydelete" value="sunday">
                    <button type="submit" class="btn-sm btn-outline-danger" style="display: inline; size: 50%; border: 0; margin-bottom: 5px;">Remove</button>
                    </form>
                    <br>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>


    <br><br>
    <h1 style="color: #00981e; size: 15pt; text-align: center;">Macros</h1>
    <h6 style="color: #00981e; text-align: center;">Your Daily Average</h6>
    <br><br>
    
    <div style="text-align: center;">
        <h5 style="display: inline; color: black; text-align: center; vertical-align: middle; margin-right: 30px;">Calories</h5>
        <h2 style="display: inline; color: #00981e; size: 15pt; text-align: center; vertical-align: middle;">{{macros.average_calories}}</h2>
    </div>
    <br><br><br>
    
    <div style="text-align: center;">
        <h6 style="display: inline; color: black; text-align: center; vertical-align: middle; margin-right: 30px;">Fat</h6>
        <h4 style="display: inline; color: #00981e; size: 15pt; text-align: center; vertical-align: middle;">{{macros.average_fat}} g</h4>
    </div>
    <br><br>
    
    <div style="text-align: center;">
        <h6 style="display: inline; color: black; text-align: center; vertical-align: middle; margin-right: 30px;">Carbs</h6>
        <h4 style="display: inline; color: #00981e; size: 15pt; text-align: center; vertical-align: middle;">{{macros.average_carb}} g</h4>
    </div>
    <br><br>
    
    <div style="text-align: center;">
        <h6 style="display: inline; color: black; text-align: center; vertical-align: middle; margin-right: 30px;">Protein</h6>
        <h4 style="display: inline; color: #00981e; size: 15pt; text-align: center; vertical-align: middle;">{{macros.average_protein}} g</h4>
    </div>
    <br><br><br>
    
    <h3 style="color: #00981e; size: 15pt; text-align: center;">Macros Percentage of Calories</h3>
    <br>
    
    <div style="width: 450px; margin: auto;">
        <canvas id="barChart"></canvas>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
        <script>
            new Chart(document.getElementById('barChart'), {
              type: 'bar',
              data: {
                labels: ['Fat', 'Carbs', 'Protein'],
                datasets: [{
                  label: 'Percentage',
                  backgroundColor: ['Blue', 'Green', 'Red'],
                  borderColor: 'white',
                  data: ["{{percentage.fat}}", "{{percentage.carb}}", "{{percentage.protein}}"]
                }]
              },
              options: {
                scales: {
                  y: {
                    beginAtZero: true
                  }
                },
                plugins: {
                  legend: {
                    display: false
                  }
                }
              }
            });
        </script>
    </div>
    
    <br><br>
    
    <div style="width: 450px; margin: auto;">
        <canvas id="pieChart"></canvas>
        <script>
            new Chart(document.getElementById('pieChart'), {
                type: 'pie',
                data: {
                    labels: ['Fat', 'Carbs', 'Protein'],
                    datasets: [{
                        label: 'Macros Distribution',
                        data: ["{{percentage.fat}}", "{{percentage.carb}}", "{{percentage.protein}}"],
                        backgroundColor: ['Blue', 'Green', 'Red'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        </script>
    </div>
    
    <br><br><br>
    {% endif %}

    <br><br><br>

{% endblock %}